### Nutrition Telegram Bot (ru)

–ë–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –æ–ø–∏—Å–∞–Ω–∏—è–º: —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –±–ª—é–¥–æ, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–æ—Ä—Ü–∏—é –∏ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å, —Ö—Ä–∞–Ω–∏—Ç –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É –∏ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∫–∞–ª–æ—Ä–∏–π.

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–µ–≤–æ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –≤ –¥–µ–Ω—å
- **–ê–Ω–∞–ª–∏–∑ –µ–¥—ã —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:**
  - üì∏ –§–æ—Ç–æ –±–ª—é–¥–∞
  - ‚úçÔ∏è –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–∞—Å—Ç–∞ –∫–∞—Ä–±–æ–Ω–∞—Ä–∞", "200–≥ —Ä–∏—Å–∞")
  - üì∏+‚úçÔ∏è –§–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:** –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ("ü§î –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...", "üìä –°—á–∏—Ç–∞—é –∫–∞–ª–æ—Ä–∏–∏..." –∏ –¥—Ä.)
- –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ OpenAI Vision (gpt-4o-mini –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–≥–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –≤ SQLite
- –ö–æ–º–∞–Ω–¥—ã: `/start`, `/target`, `/timezone [TZID]`, `/status`

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã API —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- OpenAI GPT-4o/4o-mini (–≤ –∫–æ–¥–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- Google Gemini 1.5 Flash/Pro Vision
- Anthropic Claude 3.5 Sonnet Vision
- DeepSeek-VL (—á–µ—Ä–µ–∑ –∏—Ö API)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `app/vision_providers/openai_provider.py`.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1) Python 3.11+
2) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

3) –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
TELEGRAM_BOT_TOKEN=...  # —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
OPENAI_API_KEY=...      # –∫–ª—é—á OpenAI
OPENAI_VISION_MODEL=gpt-4o-mini  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
DEFAULT_TIMEZONE=Europe/Moscow   # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

4) –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:

```bash
python -m app.bot
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º. –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–∏–º–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/target` ‚Äî –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ (–º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ `/target 2000`). –î–ª—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/timezone` –∏–ª–∏ `/timezone Europe/Paris`.
- **–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –µ–¥–µ –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º:**
  - üì∏ –§–æ—Ç–æ –±–ª—é–¥–∞
  - ‚úçÔ∏è –¢–µ–∫—Å—Ç: "–ø–∞—Å—Ç–∞ –∫–∞—Ä–±–æ–Ω–∞—Ä–∞", "–æ–º–ª–µ—Ç –∏–∑ 3 —è–∏—Ü", "200–≥ –≥—Ä–µ—á–∫–∏ —Å –∫—É—Ä–∏—Ü–µ–π"
  - üì∏+‚úçÔ∏è –§–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç "300–≥" –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–µ—Ç–∞–ª–∏
- –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ –ø–æ—Å—á–∏—Ç–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∫–∞–ª–æ—Ä–∏–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

#### –•—Ä–∞–Ω–∏–ª–∏—â–µ
- SQLite –±–∞–∑–∞ `nutrition.db` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

#### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –µ–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–∏–π API —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (OpenAI). –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä/—Ö–æ—Å—Ç–∏–Ω–≥ –º–æ–¥–µ–ª–∏. 

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Docker Compose)

```bash
cd /opt/nutrition-bot
sudo git pull
sudo docker compose up -d --build
``` 

#### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

- –õ–æ–≥–∏ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
sudo docker compose -f /opt/nutrition-bot/docker-compose.yml logs -f
# –∏–ª–∏
sudo docker logs -f nutrition-bot
```

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
sudo docker ps --filter name=nutrition-bot
```

- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö SQLite:

```bash
# —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
sudo docker cp nutrition-bot:/app/nutrition.db /tmp/nutrition.db

# —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cli (–æ–¥–∏–Ω —Ä–∞–∑)
sudo apt-get update && sudo apt-get install -y sqlite3

# —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
sqlite3 /tmp/nutrition.db '.tables'

# –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
sqlite3 /tmp/nutrition.db 'SELECT telegram_id, calorie_target, timezone FROM users ORDER BY telegram_id;'

# —Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sqlite3 /tmp/nutrition.db 'SELECT u.telegram_id, COALESCE(COUNT(m.id),0) AS photos FROM users u LEFT JOIN meals m ON m.user_id=u.telegram_id GROUP BY u.telegram_id ORDER BY photos DESC;'

# –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏
sqlite3 /tmp/nutrition.db 'SELECT id, user_id, dish, calories, created_at_utc FROM meals ORDER BY id DESC LIMIT 20;'
``` 